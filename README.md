# SignalK socketcan device

SignalK data provider that presents itself as an N2k device to the N2k bus using any connected CAN hardware accessible via socketcan interface.

The provider needs PGNs from the bus as its input. At the moment only supported input format is the one generated by [canboat](https://github.com/canboat/canboat)'s `analyzer` with its `-json` option.

The provider passes its input unaltered to the next provider in the chain. This allows chaining e.g. [n2k-signalk](https://github.com/SignalK/signalk-server-node/blob/master/providers/n2k-signalk.js) after the provider itself. In addition to passing PGNs through, the provider writes required PGNs to the configured socketcan interface to claim address from the N2k bus and send product information when asked for it. Communication to the bus is done using [socketcan-writer](https://github.com/canboat/canboat/tree/master/socketcan-writer) utility from canboat.

**Note!** This implementation is far from being complete according to N2k specification and proper care should be taken when using this provider as it writes to the N2k bus and thus can produce completely unexpected behavior of any of the connected devices! 


## Usage

  1. Install the provider to the SignalK Node server directory:

     `npm install https://github.com/chacal/signalk-socketcan-device`

  2. Use e.g. following SignalK provider configuration:
```
"pipedProviders": [{
  "id": "can0",
  "pipeElements": [
    {
      "type": "providers/execute",
      "options": {
        "command": "candump can0 | candump2analyzer | analyzer -json -si -nv"
      }
    },
    {
      "type": "providers/liner"
    },
    {
      "type": "providers/from_json"
    },
    {
      "type": "signalk-socketcan-device",
      "options": {
        "n2kAddress": 110,
        "canDevice": "can0"
      }
    },
    {
      "type": "providers/n2k-signalk"
    }
  ]
}]
```

Note that `-nv` option needs to be given to `analyzer` to include raw values of some PGNs to the output JSON.

### Supported options

  `n2kAddress` N2k address that is claimed from the bus. Defaults to 100. 
  
  `canDevice` Socketcan device to which the data is written. Defaults to `can0`.
  
  `useDummySocketcanWriter` When set to `true` no data is written to CAN bus, but PGNs are written to the debug output.

## Thanks

All the heavy lifting was already done by others. Many thanks especially for Timo Lappalainen for his [NMEA2000](https://github.com/ttlappalainen/NMEA2000) library and Kees Verruijt for [canboat](https://github.com/canboat/canboat).
